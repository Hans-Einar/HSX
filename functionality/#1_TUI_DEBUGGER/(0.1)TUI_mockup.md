# TUI Mockup — HSX Debugger Toolkit

> ASCII sketches exploring potential layouts for the debugger TUI. Panels and labels are illustrative; final naming/metrics may change during design.

---

## Mockup A — Default Layout (Registers / Trace / Disassembly / Tabbed Aux Panel)
```
┌─────────────────────────┬──────────────────────────────────────┬───────────────────────────────┐
│ Registers (PID 2)       │ Execution Trace                     │ Disassembly                   │
│─────────────────────────│──────────────────────────────────────│───────────────────────────────│
│ PC : 0x09F8             │ ▶ 0x09F8: ST  R7 + -4 ← R2           │ 0x09F8: ST   MEM[R7 + -4] <- R2│
│ SP : 0x7FF0             │   0x09FC: ST  R7 + -16 ← R1          │ 0x09FC: ST   MEM[R7 + -16] <- R1│
│ R0 : 0x00000000         │   0x0A00: LD  R9 ← MEM[R7 + -4]      │ 0x0A00: LD   R9, [R7 + -4]      │
│ R1 : 0x000040EF         │   0x0A04: ST  R7 + -20 ← R9          │ 0x0A04: ST   MEM[R7 + -20] <- R9│
│ R2 : 0x00000005         │   0x0A08: JMP 0x0A10                 │ 0x0A08: JMP  0x0A10            │
│ ...                     │   0x0A10: LD  R4 ← MEM[R7 + -20]     │ 0x0A10: LD   R4, [R7 + -20]     │
│                         │                                      │ 0x0A14: CMP  R4, R0             │
│                         │                                      │ ...                            │
├─────────────────────────┴──────────────────────────────────────┴───────────────────────────────┤
│ Tabs: [Mailboxes] [dmesg] [stdio] [scheduler] [breakpoints]                                     │
│────────────────────────────────────────────┬────────────────────────────────────────────────────│
│ ┌ Mailboxes ──────────────────────────────┐ │ [Alt+S] Step   [Alt+R] Run   [Alt+B] Breakpoints  │
│ │ svc:stdio.in@2   depth=4                │ │ [Alt+C] Continue   [Alt+Q] Quit   [Alt+M] Memory  │
│ │ app:procon       depth=1                │ │ [Alt+W] Watch vars [Alt+T] Trace   [Alt+D] Disasm │
│ │ shared:hsx.msg   depth=3                │ │──────────────────────────────────────────────────│
│ └─────────────────────────────────────────┘ │ Status: RUNNING | PID=2 | Step=1095 | Program:    │
│                                             │ examples/demos/build/mailbox/producer.hxe        │
└────────────────────────────────────────────┴────────────────────────────────────────────────────┘
```
- Tab system replaces the earlier multi-panel AUX layout; only one auxiliary view is visible at a time.
- Right-hand shortcut legend mimics YaST-style UI (`Alt+S`, `Alt+R`, etc.).
- Status bar surfaces mode (RUN/STEP/BREAK), active PID, and key runtime counters.
- Internal refresh clock (e.g., 250 ms tick) broadcasts update signals so panels stay current even without incoming execd events.

---

## Mockup B — Compact Mode (Collapsed Aux Tabs)
```
┌───────────────┬──────────────────────────────────────────────────────────────┐
│ Registers     │ Execution Trace / Disassembly (linked view)                  │
│───────────────│──────────────────────────────────────────────────────────────│
│ PC : 0x09F8   │ ▶ 0x09F8: ST   MEM[R7 + -4] <- R2                            │
│ SP : 0x7FF0   │    0x09FC: ST   MEM[R7 + -16] <- R1                          │
│ ...           │    0x0A00: LD   R9, [R7 + -4]                                │
│───────────────┴──────────────────────────────────────────────────────────────┤
│ Aux Tabs: [Mailboxes]  [dmesg]  [stdio]  [scheduler]  [breakpoints] (press t) │
└──────────────────────────────────────────────────────────────────────────────┘
```
- Designed for users who want maximal trace/disassembly space.
- Auxiliary panel collapses into the tab bar; pressing `t` or selecting a tab expands it.

---

## Mockup C — Breakpoint Manager Tab
```
┌──────────────────────────────────────────────────────────────────────────────┐
│ Breakpoint Manager (Alt+B)                                                  │
│──────────────────────────────────────────────────────────────────────────────│
│ Functions:                                                                  │
│   main()                         [    ]                                     │
│   ├── init_system()              [ X ]  0x0204                              │
│   ├── mailbox_send()             [    ]  0x030C                              │
│   ├── scheduler_tick()           [ X ]  0x0428                              │
│   └── uart_isr()                 [    ]  0x0572                              │
│                                                                              │
│ Disassembly (scrollable):                                                    │
│  0x0424: LD   R0, [R7 + -4]                                                 │
│▶ 0x0428: CALL 0x055A          ← Breakpoint (scheduler_tick)                 │
│  0x042C: ST   MEM[R7 + -4] <- R2                                            │
│                                                                              │
│ [Alt+A] Add   [Alt+R] Remove   [Alt+E] Enable/Disable   [Alt+S] Step        │
└──────────────────────────────────────────────────────────────────────────────┘
```
- Left column lists functions/symbols (parsed from LLC JSON or disassembly) with checkbox state for breakpoints.
- Right pane mirrors the disassembly, highlight synced with PC and breakpoint entries.
- Keyboard shortcuts allow quick manipulation without leaving the TUI.

---

## Breakpoint Handling Concepts
- **Virtual breakpoints (default):** run VM in auto single-step mode and evaluate `PC` after each instruction; pause when it matches an enabled breakpoint.
- **BRK instruction support:** when `BRK` opcodes fire (`BP_TRAP`), debugger enters break mode; coexists with virtual breakpoints.
- **Data model (draft):**
  ```c
  struct Breakpoint {
      uint16_t addr;
      bool     enabled;
      bool     hit;
      char     symbol[32];
  };
  ```

---

## Mockup D — Call Stack & Memory Inspector (Registers pane alternative)
```
┌─────────────────────────┬──────────────────────────────────────────────┐
│ Call Stack (PID 2)      │ Memory Inspector (alt view toggle)           │
│─────────────────────────│──────────────────────────────────────────────│
│ ▶ #0 mailbox_send()     │ Address: 0x7FF0  [Stack]                     │
│   #1 main()             │  0x7FF0: 00 7F 00 00  04 00 00 00           │
│   #2 _start()           │  0x7FF8: 10 0A 00 00  1C 0A 00 00           │
│                         │  0x8000: 00 00 00 00  00 00 00 00           │
│─────────────────────────│----------------------------------------------│
│ [Alt+L] Locals  [Alt+U] Up  [Alt+D] Down  [Alt+M] Toggle Memory View   │
└─────────────────────────┴──────────────────────────────────────────────┘
```
- Stack panel slots into the left column when users toggle away from registers.
- Memory inspector can display stack/global memory with editable cells (future work).
- Keyboard shortcuts align with register view for consistency.

---

## Mockup E — Watch List Tab (Auxiliary panel)
```
┌ Watch List ───────────────────────────────┐
│ Symbol            Value        Notes      │
│ counter          0x00000005  (global)    │
│ queue.depth      0x00000003  (mailbox)   │
│ dm.state         0x00000001  (enum)      │
│ crc_acc          0x0000A1B2  (watch)     │
│──────────────────────────────────────────│
│ [Alt+W] Add watch  [Alt+E] Edit  [Del] Remove │
└──────────────────────────────────────────┘
```
- Watch list lives as another auxiliary tab; variable updates are driven by event mailbox + refresh tick.

---

## Keyboard Shortcuts (brainstorm)
| Function       | Shortcut |
|----------------|----------|
| Step           | Alt+S    |
| Run            | Alt+R    |
| Continue       | Alt+C    |
| Breakpoints    | Alt+B    |
| Watch vars     | Alt+W    |
| Trace toggle   | Alt+T    |
| Disassembly    | Alt+D    |
| Memory view    | Alt+M    |
| Quit           | Alt+Q    |
| Switch tabs    | ← / → or Alt+1–5 |

Tabs can also be toggled programmatically; highlight indicates active pane.

---

## Design Notes
- Tabbed auxiliary panel keeps the layout clean while enabling varied telemetry (mailboxes/dmesg/stdio/scheduler/breakpoints).
- Consistent shortcut legend aids discoverability across pages.
- Automatic single-step execution simplifies breakpoint detection and ensures deterministic behaviour.
- Status bar aggregates mode, PID, runtime counters, and program metadata (pretty output from `ps <pid>`).
- Event flow combines executive-published mailbox notifications with the internal refresh clock so the UI reacts promptly without heavy polling.

> Treat this file as a brainstorming canvas—update as the design evolves.
