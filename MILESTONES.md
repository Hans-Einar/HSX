# HSX Project Milestones

---

## Milestone 1 - HSX VM Functional
**Date:** 2025-10-04
**Status:** Completed

### Description
Initial end-to-end toolchain from C source -> LLVM IR -> HSX assembly -> HSX executable (.hxe) -> VM execution is working. Sample programs compile and run inside the Python VM.

### Achievements
- Implemented the LLVM -> HSX pipeline via `python/hsx-llc.py`, `python/asm.py`, and `python/hld.py`.
- Defined the `.hxe` container (HSXE magic, version 0x0001, CRC32) and linker packaging flow.
- `platforms/python/host_vm.py` executes generated bytecode, handles SVC EXIT, and reports program status.
- Added Codex integration guidance to help future contributors extend the stack consistently.

### Next Step
Move into Milestone 2 (Toolchain Foundation). Add regression tests under `python/tests/` and document SVC APIs.

---

## Milestone 2 - Toolchain Foundation
**Status:** Completed

### Description
Expanded the Python toolchain so the HSX build pipeline is reliable and well-tested across representative IR patterns.

### Highlights
- Extended `python/hsx-llc.py`, `python/asm.py`, and `python/hld.py` with MOV/phi/call lowering, `.hxo` packaging, linker integration, and assembler quality-of-life switches.
- Added mirrored C samples and pytest coverage for mov/icmp/call/half flows, plus CLI smoke tests for the C->HSX pipeline.
- Instrumented `platforms/python/host_vm.py` with CLI flags (`--entry-symbol`, `--max-steps`, `--trace-file`) and dev-libm hooks.
- Consolidated documentation under `docs/` with the refactor roadmap, Doxygen scaffolding, and Make-based workflows for examples/tests.

### Next Step
Use the strengthened toolchain as the base for the multi-task executive and orchestration stack (Milestone 3).

---

## Milestone 3 - Multi-tasking Executive
**Status:** Completed

### Description
Built a Python executive that can schedule multiple HSX tasks, expose an RPC protocol, and provide operator tooling across the VM stack.

### Highlights
- Added register/stack base-pointer contexts, state snapshot/restore, and cycle accounting to `platforms/python/host_vm.py`.
- Introduced the scheduler service (`python/executive.py`) and managed daemon (`python/execd.py`) that drive the VM via RPC.
- Delivered the TCP shell client (`python/shell_client.py`) with `ps`, `exec`, `kill`, attach/detach, and health commands.
- Shipped supporting operator tools (`python/blinkenlights.py`, `python/exec_smoke.py`) and documented the JSON message protocol.

### Next Step
Wire in inter-task communication and stdio routing via the mailbox subsystem (Milestone 4).

---

## Milestone 4 - Mailbox & STDIO Integration *(In Progress)*
Build out the mailbox subsystem and stdio abstraction so HSX tasks can exchange messages and stream I/O through the executive.

### Progress
- Mailbox SVC 0x05 is implemented end-to-end with descriptor namespaces, bounded queues, and scheduler wait/wake handling (`platforms/python/host_vm.py`).
- Shell RPC and CLI already expose `listen`/`send`, and unit tests cover the exec-side helpers plus blocking receive/timeout behaviour (`python/tests/test_exec_mailbox.py`, `python/tests/test_mailbox_wait.py`).
- Common constants live in `include/hsx_mailbox.h` and are mirrored automatically into the Python stack.
- Added an assembly stdio shim (`examples/lib/hsx_stdio.mvasm`) with helpers for stdout/stderr plus a sample that streams greeting output (`examples/tests/test_stdio_mailbox`).
- Producer sample demonstrates mailbox messaging (`examples/tests/test_mailbox_producer`), and integration tests exercise stdio output and host-side mailbox inspection (`python/tests/test_mailbox_integration.py`).
- Assembly-backed C wrapper library (`examples/lib/hsx_mailbox.h`, `examples/lib/hsx_stdio.h`) and mirrored mailbox/stdio samples in C (`examples/tests/test_mailbox_producer_c`, `examples/tests/test_mailbox_consumer_c`, `examples/tests/test_stdio_mailbox_c`).

### Remaining Objectives
- Expand the stdio shim with fuller stdin helpers and canonical C wrappers (current `hsx_stdio_read` still polls/yields).
- Promote the new C consumer sample to use blocking stdin/mailbox helpers once read-side buffering moves beyond polling.
- Broaden integration coverage for mailbox back-pressure and tap tracing beyond the current host-inspection tests.
- Coordinate with Milestone 5 to land the calling convention extension (register/stack overflow rules) so stdio/mailbox helpers can rely on arbitrary argument counts once the ABI is committed.

---

## Milestone 5 - ABI & Calling Convention Stabilization *(In Progress)*
Define and implement a robust HSX calling convention that supports functions with more than three parameters without ad-hoc workarounds.

### Objectives
- Lock down the ABI reference in `docs/hsx_spec-v2.md` (register classes, caller/callee responsibilities, overflow layout for arguments â‰¥4, aggregate/varargs handling) and mirror the summary in contributor docs.
- Teach `python/hsx-llc.py` (plus MVASM assembler/linker) to spill overflow arguments onto 4-byte aligned stack slots, emit callee reload stubs, and preserve callee-saved registers as defined by the spec.
- Update runtime helpers and libraries (`include/hsx_*`, `examples/lib/*.mvasm`) so stdio/mailbox shims, exec syscalls, and native bridges honour the revised calling convention.
- Add regression coverage spanning C/MVASM samples, pytest scenarios, and integration tests that exercise >3 argument calls, mixed-width arguments, and varargs entry points.
- Re-run the full toolchain (`make -C examples/tests`, `make -C python test`) and update release notes once the ABI changes land to verify compatibility across prior milestones.

---

## Milestone 6 - Value/Command System *(Planned)*
Introduce the Value/Command SVC modules (0x07/0x08) on top of the mailbox/stdio infrastructure.

### Objectives
- Persisted value table (with optional FRAM backing) and command dispatcher accessible through shell tooling.
- Integrate value/command flows with mailbox/stdio for monitoring and operator feedback.
- Provide HSX and Python examples manipulating the value table and invoking commands end-to-end.

---

## Milestone 7 - HAL Integration *(Planned)*
Unify device-level I/O through the HAL.

### Components
- GPIO, ADC, PWM, I2C, and SPI abstractions.
- Syscall enumeration and capability discovery inside the VM.
- Event-driven I/O simulation support.

---

## Milestone 8 - Hardware Deployment / FRAM + NOR *(Planned)*
Port the HSX Executive to AVR128DA28 and manage hybrid flash/FRAM memory.

### Tasks
- NOR cache manager for program pages, FRAM for task data.
- Cooperative scheduler on target hardware.
- Validate CAN + UART shell on real hardware.

---

## Milestone 9 - Debugger & Tooling *(Planned)*
Develop interactive debugging support and richer developer ergonomics across the HSX toolchain.

### Objectives
- Design breakpoint and single-step support for the Python VM and future hardware targets.
- Extend assembler/VM metadata to surface source locations and symbol tables.
- Integrate trace/inspection commands into shell tooling and document the workflow.

---

## Repository Snapshot
To be updated alongside the next packaged release.
