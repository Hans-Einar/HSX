# HSX Project Milestones

---

## Milestone 1 – C → HSX VM Functional
**Date:** 2025-10-04  
**Status:** ✅ Completed

### Description
Initial end-to-end toolchain from C source → LLVM IR → HSX assembly → HSX executable (.hxe) → VM execution is working. `hello.c` compiles and runs inside the Python VM.

### Achievements
- Implemented the LLVM → HSX pipeline via `hsx-llc.py`, `asm.py`, and `host_vm.py`.
- Defined the `.hxe` format (HSXE magic, version 0x0001, CRC32).
- VM successfully executes generated bytecode and reports `R0 = 42`.
- Added Codex integration guidance for future expansion.

### Next Step
Move into Milestone 2 (Toolchain+). Add regression tests under `python/tests` and document SVC APIs.

---

## Milestone 2 – Toolchain+ (In Progress)
Enhance the Python toolchain with broader IR coverage, call/branch lowering, and richer testing.

### Goals
- Complete the open TODO list in `AGENTS.md`.
- Verify multiple C examples (hello, branching, calls, half ops) execute in the VM.
- Grow pytest coverage for `hsx-llc.py` and assembler behaviour.

### Progress Log
- 2025-10-05: Added MOV-optimisation pass, icmp lowering, phi handling, call lowering, and half precision support. Created regression C samples (`loadstore`, `icmp`, `call`) and matching batch pipelines. Added pytest coverage for MOV, icmp, phi/call cases. VM now supports logical ops used by the new lowering.
- 2025-10-06: Extended host VM with --entry-symbol/--max-steps/--trace-file flags, dev-libm handlers, and SVC EXIT; added CLI batch runs for `call`/`phi`; new pytest coverage for VM exit and dev-libm trace paths.
- 2025-10-07: Completed `_Float16` lowering end-to-end (fptosi, float alias folding) so `half_test.bat` succeeds; added .import auto-emission and acceptance in assembler; new pytest suite covering half conversions.
- 2025-10-08: Added `.hxo` object output and JSON linker (`hld.py`), automated a multi-object C pipeline via `link_test.bat`, and expanded host VM coverage with CLI tests for `--max-steps`, `--trace-file`, and `--entry-symbol`.

---

## Milestone 3 – F16 + Value/Command System
Introduce half-precision operations end-to-end and wire up Value/Command SVC modules (0x5/0x7/0x8).

### Planned Features
- `_Float16` instruction set (FADD, FMUL, F2I, I2F).
- Persisted value table in FRAM with UART/CAN shell access.
- Command dispatcher for exec subsystem.

---

## Milestone 4 – Mailbox/Event System
Add asynchronous task communication and event signalling.

### Objectives
- Implement mailbox queues and wait/wake semantics.
- Provide syscalls for `halt`, `kill`, `usr`, `send`.
- Extend shell tooling to observe and manage tasks.

---

## Milestone 5 – HAL Integration
Unify device-level I/O through the HAL.

### Components
- GPIO, ADC, PWM, I2C, SPI abstractions.
- Syscall enumeration and capability discovery inside the VM.
- Event-driven I/O simulation support.

---

## Milestone 6 – Hardware Deployment / FRAM + NOR
Port HSX Executive to AVR128DA28 and manage hybrid flash/FRAM memory.

### Tasks
- NOR cache manager for program pages, FRAM for task data.
- Cooperative scheduler on target hardware.
- Validate CAN + UART shell on real hardware.

---

---

## Milestone 7 - Debugger & Tooling
Develop interactive debugging support and richer developer ergonomics across the HSX toolchain.

### Objectives
- Design breakpoint and single-step support for the Python VM and future hardware targets.
- Extend assembler/VM metadata to surface source locations and symbol tables.
- Integrate trace/inspection commands into shell tooling and document the workflow.

## Repository Snapshot (Milestone 1)
```
HSX/
  python/
    asm.py
    host_vm.py
    hsx-llc.py
    hld.py
    tests/
  examples/
    c/hello.c
    hello.ll
    hello.mvasm
    hello.hxe
  AGENTS.md
  MILESTONES.md
  HSX_ARCHITECTURE.md
```
