# Design Spec - TUI Debugger
# 04.10--TUI_Debugger Design (v3, repo style)
**Status:** DRAFT | **Date:** 2025-10-30 | **Owner:** HSX Core

> **Design stance:** The TUI debugger is a full-screen terminal interface providing real-time visualization and control of HSX runtime state. It is built on the debugger core and protocol defined in [04.09--Debugger.md](04.09--Debugger.md), performing no direct VM manipulation and coordinating all operations through the executive RPC.

**Authoritative context (repo-local):**
- Debugger Protocol: [04.09--Debugger.md](04.09--Debugger.md)
- Architecture: [03.06--Toolkit](../03--Architecture/03.06--Toolkit.md), [03.00--Architecture](../03--Architecture/03.00--Architecture.md)
- Study & Requirements: [02--Study](../02--Study/02--Study.md), [02.01--Requirements](../02--Study/02.01--Requirements.md)
- Implementation-phase specs: [docs/executive_protocol.md](../../docs/executive_protocol.md)

**Traceability (fill from 02.01--Requirements):** Refs DR-8.1, DG-8.1, DG-8.2, DG-8.3.

## 1. Scope
- Full-screen terminal user interface (TUI) for HSX debugger with real-time state visualization (DR-8.1, DG-8.1).
- Modular panel-based layout showing registers, disassembly, execution trace, call stack, memory inspector, watch list, and auxiliary views (DR-8.1, DG-8.1).
- Event-driven updates with internal refresh clock for responsive UI without manual polling (DR-8.1, DG-8.2).
- Keyboard-driven navigation and control with consistent shortcuts across panels (DG-8.1, DG-8.3).
- Cross-platform support for Windows PowerShell, macOS Terminal, and Linux terminals (DG-8.3).

## 2. Preconditions
- Debugger core package (`hsxdbg`) provides session management, event streaming, and state caching per [04.09--Debugger.md](04.09--Debugger.md) (DR-8.1, DG-8.2).
- Executive implements debugger protocol with event subscription and structured event delivery (DR-8.1, DG-8.2).
- Symbol metadata available from toolchain for disassembly annotations and watch expressions (DR-3.1, DG-3.3).
- Terminal environment supports ANSI escape sequences and has minimum dimensions of 80x24 characters (DG-8.3).

## 3. Postconditions
- TUI provides intuitive interface for debugging HSX applications with minimal learning curve (DR-8.1, DG-8.1).
- Panels update in real-time (<200ms) when executive emits events or user performs actions (DR-8.1, DG-8.2).
- Users can navigate, inspect, and control execution using only keyboard shortcuts (DG-8.1, DG-8.3).
- Layout adapts to terminal size with responsive resizing behavior (DG-8.3).

## 4. Architectural Overview

### 4.1 Design Principles
- **Event-driven UI:** All panel updates triggered by events from debugger core; no polling loops.
- **Modular panels:** Each view (registers, disassembly, trace, etc.) is an independent component subscribing to relevant events.
- **Keyboard-first:** All functionality accessible via keyboard shortcuts; mouse support optional.
- **Responsive layout:** Panels resize dynamically based on terminal dimensions and user preferences.
- **Graceful degradation:** Core functionality remains accessible even if advanced features unavailable.

### 4.2 Framework Selection
The TUI is built using **Textual** framework for the following reasons:

**Advantages:**
- Modern Python TUI framework with high-level layout primitives
- Native asyncio integration compatible with debugger event bus
- Excellent Windows/PowerShell support (ANSI escape sequences)
- Built-in widget system (containers, tables, text areas, etc.)
- Automatic layout management and responsive resizing
- Active development and comprehensive documentation

**Alternatives Considered:**
- `prompt_toolkit`: Excellent for CLI REPL but limited multi-pane dashboard support
- `urwid`: Lacks native Windows support and complicates asyncio integration
- `curses`: Poor Windows support and requires extensive layout scaffolding

**Dependencies:**
- `textual >= 0.58.0` (verified stable release)
- `rich >= 13.0.0` (rendering engine used by Textual)

### 4.3 Component Architecture

#### 4.3.1 Application Shell
- Main application class managing layout, event routing, and lifecycle
- Connection manager for debugger core session
- Global keyboard handler for shortcuts
- Theme and style management

#### 4.3.2 Panel Components
Each panel is a Textual widget subscribing to relevant events:

- **Registers Panel:** Display R0-R15, PC, SP, PSW with change highlighting
- **Disassembly Panel:** Show instructions around PC with symbols and breakpoint markers
- **Trace Panel:** Scrollable execution history with PC, opcode, and flags
- **Stack Panel:** Call stack with frame pointers and symbol names
- **Memory Inspector:** Hex dump with ASCII preview and editable cells
- **Watch List:** Variables and expressions with value tracking
- **Mailbox Panel:** Descriptor activity and recent messages
- **Console Panel:** Stdout/stderr output and command input
- **Status Bar:** Connection info, PID, state, and runtime counters

#### 4.3.3 Event Handlers
- Subscribe to debugger core event bus for each event category
- Transform events into panel update messages
- Throttle high-frequency updates to maintain UI responsiveness

## 5. Layout Design

### 5.1 Default Layout
```
┌─────────────────────────┬──────────────────────────────────────┬───────────────────────────────┐
│ Registers (PID 2)       │ Execution Trace                     │ Disassembly                   │
│─────────────────────────│──────────────────────────────────────│───────────────────────────────│
│ PC : 0x09F8             │ ▶ 0x09F8: ST  R7 + -4 ← R2           │ 0x09F8: ST   MEM[R7 + -4] <- R2│
│ SP : 0x7FF0             │   0x09FC: ST  R7 + -16 ← R1          │ 0x09FC: ST   MEM[R7 + -16] <- R1│
│ R0 : 0x00000000         │   0x0A00: LD  R9 ← MEM[R7 + -4]      │ 0x0A00: LD   R9, [R7 + -4]      │
│ R1 : 0x000040EF         │   0x0A04: ST  R7 + -20 ← R9          │ 0x0A04: ST   MEM[R7 + -20] <- R9│
│ R2 : 0x00000005         │   0x0A08: JMP 0x0A10                 │ 0x0A08: JMP  0x0A10            │
│ R3 : 0x00000000         │   0x0A10: LD  R4 ← MEM[R7 + -20]     │ 0x0A10: LD   R4, [R7 + -20]     │
│ ...                     │                                      │ 0x0A14: CMP  R4, R0             │
│                         │                                      │ ...                            │
├─────────────────────────┴──────────────────────────────────────┴───────────────────────────────┤
│ Tabs: [Mailboxes] [dmesg] [stdio] [scheduler] [breakpoints] [watch] [memory]                   │
│────────────────────────────────────────────────────────────────────────────────────────────────│
│ ┌ Mailboxes ────────────────────────────────────────────────────────────────────────────────┐ │
│ │ svc:stdio.in@2   depth=4   bytes=128/1024                                                │ │
│ │ app:procon       depth=1   bytes=32/512                                                  │ │
│ │ shared:hsx.msg   depth=3   bytes=96/2048                                                 │ │
│ └──────────────────────────────────────────────────────────────────────────────────────────┘ │
├────────────────────────────────────────────────────────────────────────────────────────────────┤
│ [Alt+S] Step   [Alt+R] Run   [Alt+B] Breakpoints   [Alt+C] Continue   [Alt+Q] Quit            │
│ [Alt+W] Watch  [Alt+T] Trace [Alt+D] Disasm        [Alt+M] Memory     [Alt+H] Help            │
│────────────────────────────────────────────────────────────────────────────────────────────────│
│ Status: RUNNING | PID=2 | Step=1095 | Program: examples/demos/build/mailbox/producer.hxe      │
└────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 Compact Mode (Collapsed Auxiliary Panel)
```
┌───────────────┬──────────────────────────────────────────────────────────────┐
│ Registers     │ Execution Trace / Disassembly (linked view)                  │
│───────────────│──────────────────────────────────────────────────────────────│
│ PC : 0x09F8   │ ▶ 0x09F8: ST   MEM[R7 + -4] <- R2                            │
│ SP : 0x7FF0   │    0x09FC: ST   MEM[R7 + -16] <- R1                          │
│ R0 : 0x00000000│   0x0A00: LD   R9, [R7 + -4]                                │
│ ...           │    0x0A08: JMP  0x0A10                                       │
│───────────────┴──────────────────────────────────────────────────────────────│
│ Aux: [Mailboxes] [dmesg] [stdio] [scheduler] [breakpoints] (press Tab)      │
│ Status: RUNNING | PID=2 | Step=1095                                         │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 5.3 Stack View (Alternative to Registers)
```
┌─────────────────────────┬──────────────────────────────────────┬───────────────────────────────┐
│ Call Stack (PID 2)      │ Execution Trace                     │ Disassembly                   │
│─────────────────────────│──────────────────────────────────────│───────────────────────────────│
│ ▶ #0 mailbox_send()     │ ▶ 0x09F8: ST  R7 + -4 ← R2           │ 0x09F8: ST   MEM[R7 + -4] <- R2│
│   PC: 0x09F8            │   0x09FC: ST  R7 + -16 ← R1          │ 0x09FC: ST   MEM[R7 + -16] <- R1│
│   SP: 0x7FF0            │   0x0A00: LD  R9 ← MEM[R7 + -4]      │ 0x0A00: LD   R9, [R7 + -4]      │
│   FP: 0x7FFC            │                                      │                               │
│   #1 main()             │                                      │                               │
│   PC: 0x0E00            │                                      │                               │
│   SP: 0x8000            │                                      │                               │
│   FP: 0x800C            │                                      │                               │
│   #2 _start()           │                                      │                               │
│   PC: 0x0800            │                                      │                               │
│   SP: 0x8020            │                                      │                               │
└─────────────────────────┴──────────────────────────────────────┴───────────────────────────────┘
```

### 5.4 Memory Inspector Tab
```
┌──────────────────────────────────────────────────────────────────────────────┐
│ Memory Inspector (Alt+M)                                                     │
│──────────────────────────────────────────────────────────────────────────────│
│ Address: 0x7FF0  [Stack]   Goto: [________]  [Jump]                          │
│                                                                              │
│  Offset   +0 +1 +2 +3 +4 +5 +6 +7 +8 +9 +A +B +C +D +E +F   ASCII           │
│  ──────────────────────────────────────────────────────────────────────────  │
│  0x7FF0   00 7F 00 00 04 00 00 00 10 0A 00 00 1C 0A 00 00   ................│
│  0x8000   00 00 00 00 00 00 00 00 EF 40 00 00 05 00 00 00   .........@......│
│  0x8010   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   ................│
│  0x8020   A1 B2 00 00 03 00 00 00 00 00 00 00 00 00 00 00   ................│
│                                                                              │
│ [Alt+E] Edit  [Alt+G] Goto  [PgUp/PgDn] Scroll  [Home/End] Jump             │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 5.5 Breakpoint Manager Tab
```
┌──────────────────────────────────────────────────────────────────────────────┐
│ Breakpoint Manager (Alt+B)                                                  │
│──────────────────────────────────────────────────────────────────────────────│
│ Functions:                                                                  │
│   main()                         [    ]                                     │
│   ├── init_system()              [ X ]  0x0204                              │
│   ├── mailbox_send()             [    ]  0x030C                              │
│   ├── scheduler_tick()           [ X ]  0x0428                              │
│   └── uart_isr()                 [    ]  0x0572                              │
│                                                                              │
│ Disassembly (scrollable):                                                    │
│  0x0424: LD   R0, [R7 + -4]                                                 │
│▶ 0x0428: CALL 0x055A          ← Breakpoint (scheduler_tick)                 │
│  0x042C: ST   MEM[R7 + -4] <- R2                                            │
│                                                                              │
│ [Space] Toggle  [Alt+A] Add  [Del] Remove  [Enter] Jump to breakpoint       │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 5.6 Watch List Tab
```
┌──────────────────────────────────────────────────────────────────────────────┐
│ Watch List (Alt+W)                                                           │
│──────────────────────────────────────────────────────────────────────────────│
│ ID  Symbol            Value        Addr      Type      Notes                │
│ ────────────────────────────────────────────────────────────────────────────│
│ 1   counter          0x00000005   0x2000    uint32    Changed              │
│ 2   queue.depth      0x00000003   0x2010    uint16                         │
│ 3   dm.state         0x00000001   0x2020    enum      (ACTIVE)             │
│ 4   crc_acc          0x0000A1B2   0x2030    uint32                         │
│                                                                              │
│ Add: [________________]  [Enter to add]                                      │
│                                                                              │
│ [Alt+A] Add watch  [Alt+E] Edit  [Del] Remove  [Enter] Jump to address      │
└──────────────────────────────────────────────────────────────────────────────┘
```

## 6. Panel Specifications

### 6.1 Registers Panel

#### 6.1.1 Display Format
```
Registers (PID 2)
─────────────────
PC : 0x09F8
SP : 0x7FF0
PSW: [Z---]
R0 : 0x00000000
R1 : 0x000040EF  ◄ changed
R2 : 0x00000005
R3 : 0x00000000
...
R15: 0x00000000
```

#### 6.1.2 Features
- Highlight changed registers with marker (◄) and color
- Show PC with symbol name if available: `PC : 0x09F8 (main.loop)`
- Display PSW flags as `[ZCNV]` with active flags highlighted
- Toggle between decimal and hexadecimal display (Alt+X)
- Inline editing: press Enter on register to edit value

#### 6.1.3 Events
- Subscribe to `trace_step` events for register updates
- Subscribe to `debug_break` events for breakpoint hits

### 6.2 Disassembly Panel

#### 6.2.1 Display Format
```
Disassembly
───────────────────────────────
0x09F0: PUSH R7
0x09F4: MOV  R7, R6
▶ 0x09F8: ST   MEM[R7 + -4] <- R2
● 0x09FC: ST   MEM[R7 + -16] <- R1
  0x0A00: LD   R9, [R7 + -4]
  0x0A04: ST   MEM[R7 + -20] <- R9
  0x0A08: JMP  0x0A10
  0x0A0C: NOP
▶ 0x0A10: LD   R4, [R7 + -20]
  0x0A14: CMP  R4, R0
```

#### 6.2.2 Features
- Current PC marked with `▶` indicator
- Breakpoints marked with `●` indicator
- Symbol names shown as comments when available
- Scroll with Up/Down/PgUp/PgDn
- Jump to address (Alt+G)
- Set/clear breakpoint at cursor (Space or B)
- Follow jumps/calls (Enter on CALL/JMP instruction)

#### 6.2.3 Events
- Subscribe to `trace_step` events to update PC position
- Subscribe to `debug_break` events for breakpoint hits

### 6.3 Trace Panel

#### 6.3.1 Display Format
```
Execution Trace
────────────────────────────────
Seq    PC      Opcode  Instruction         Flags
──────────────────────────────────────────────────
1093   0x09F0  0x4007  PUSH R7             ----
1094   0x09F4  0x0476  MOV  R7, R6         ----
▶ 1095 0x09F8  0x0372  ST   R7-4 ← R2      ----
1096   0x09FC  0x0371  ST   R7-16 ← R1     ----
1097   0x0A00  0x0297  LD   R9 ← [R7-4]    ----
```

#### 6.3.2 Features
- Scrollable history buffer (configurable size, default 1000 entries)
- Current instruction highlighted with `▶`
- Clicking trace entry updates disassembly and register views
- Auto-scroll option to follow execution (toggle with F)
- Filter by instruction type (loads, stores, jumps, etc.)
- Export to file (Ctrl+E)

#### 6.3.3 Events
- Subscribe to `trace_step` events to append history
- Buffer management: drop oldest when capacity reached

### 6.4 Stack Panel

#### 6.4.1 Display Format
```
Call Stack (PID 2)
──────────────────
▶ #0 mailbox_send()
  PC: 0x09F8
  SP: 0x7FF0
  FP: 0x7FFC
  
  #1 main()
  PC: 0x0E00
  SP: 0x8000
  FP: 0x800C
  
  #2 _start()
  PC: 0x0800
  SP: 0x8020
  FP: 0x802C
```

#### 6.4.2 Features
- Current frame highlighted with `▶`
- Navigate frames with Up/Down
- Selecting frame updates register and disassembly views
- Show local variables when metadata available (Alt+L)
- Copy frame info to clipboard (Ctrl+C)

#### 6.4.3 Events
- Subscribe to `trace_step` events to update stack
- Subscribe to `debug_break` events after breakpoint hits

### 6.5 Memory Inspector Panel

#### 6.5.1 Features
- Hexadecimal and ASCII display
- Navigate with cursor keys and PgUp/PgDn
- Jump to address (Alt+G)
- Follow pointers (Enter on address value)
- Edit mode for memory writes (Alt+E, requires confirmation)
- Bookmark addresses (Ctrl+B)
- Show annotations for known symbols

#### 6.5.2 Events
- Manual refresh (does not auto-update)
- Refresh on request (R key)

### 6.6 Watch List Panel

#### 6.6.1 Features
- Add watches by symbol name or address expression
- Show current value, address, and type
- Highlight changed values
- Edit watch expression (Alt+E)
- Remove watch (Del key)
- Jump to address (Enter)

#### 6.6.2 Events
- Subscribe to `watch_update` events for value changes
- Refresh all watches after `trace_step` events

### 6.7 Auxiliary Panels

#### 6.7.1 Mailbox Panel
```
Mailboxes
─────────────────────────────────────────
Descriptor           Depth  Used   Capacity
svc:stdio.in@2       4      128    1024
app:procon           1      32     512
shared:hsx.msg       3      96     2048
```

Features:
- Subscribe to `mailbox_send` and `mailbox_recv` events
- Show recent messages (expandable view)
- Monitor queue depth and capacity

#### 6.7.2 Console Panel (stdio)
```
Console (stdio)
─────────────────────────────────────────
[2025-10-30 12:34:56] Starting producer...
[2025-10-30 12:34:57] Sending message 1
[2025-10-30 12:34:58] Message acknowledged
[2025-10-30 12:34:59] Sending message 2
```

Features:
- Subscribe to `stdout` and `stderr` events
- Auto-scroll to bottom
- Filter by stream (stdout/stderr)
- Search history (Ctrl+F)

#### 6.7.3 Scheduler Panel
```
Scheduler Statistics
─────────────────────────────────────────
PID  App           State     Steps    %CPU
2    producer      RUNNING   1095     52%
3    consumer      READY     1048     48%
```

Features:
- Subscribe to `scheduler` events
- Show task states and transitions
- Display CPU utilization per task

## 7. Keyboard Shortcuts

### 7.1 Global Shortcuts
| Shortcut | Action |
|----------|--------|
| Alt+S | Step (single instruction) |
| Alt+R | Run (continue execution) |
| Alt+P | Pause execution |
| Alt+C | Continue to next breakpoint |
| Alt+B | Show breakpoint manager |
| Alt+W | Show watch list |
| Alt+M | Show memory inspector |
| Alt+T | Focus trace panel |
| Alt+D | Focus disassembly panel |
| Alt+H | Show help |
| Alt+Q | Quit |
| F1 | Help |
| Tab | Switch between tabs |
| Ctrl+L | Refresh display |

### 7.2 Panel-Specific Shortcuts
| Shortcut | Panel | Action |
|----------|-------|--------|
| Enter | Registers | Edit register value |
| Alt+X | Registers | Toggle hex/decimal display |
| Space | Disassembly | Toggle breakpoint at cursor |
| Alt+G | Disassembly/Memory | Jump to address |
| Enter | Disassembly | Follow jump/call |
| F | Trace | Toggle auto-follow |
| Ctrl+E | Trace | Export to file |
| Up/Down | Stack | Navigate frames |
| Alt+L | Stack | Show local variables |
| Alt+E | Memory | Edit mode |
| Ctrl+B | Memory | Bookmark address |
| Del | Watch/Breakpoints | Remove item |

## 8. Event Handling and Updates

### 8.1 Event Subscription
The TUI subscribes to all event categories and routes them to relevant panels:

```python
event_subscriptions = {
    "trace_step": [registers_panel, disassembly_panel, trace_panel],
    "debug_break": [registers_panel, disassembly_panel, stack_panel, status_bar],
    "scheduler": [scheduler_panel, status_bar],
    "mailbox_send": [mailbox_panel],
    "mailbox_recv": [mailbox_panel],
    "watch_update": [watch_panel],
    "stdout": [console_panel],
    "stderr": [console_panel],
    "warning": [status_bar],
}
```

### 8.2 Update Throttling
To maintain UI responsiveness under high event rates:
- Batch events received within 50ms window
- Update UI at maximum 20 FPS (50ms intervals)
- Drop intermediate states for transient values
- Maintain event sequence numbers for gap detection

### 8.3 Refresh Clock
Internal timer (250ms) triggers periodic updates for:
- Connection status check
- Session keepalive
- Panel refresh requests
- Status bar updates

## 9. Responsive Layout

### 9.1 Minimum Dimensions
- Minimum terminal size: 80x24 characters
- Recommended size: 120x40 characters
- Optimal size: 160x50+ characters

### 9.2 Layout Adaptation
- **< 80 cols:** Switch to vertical stacking, hide auxiliary panels
- **80-120 cols:** Default three-column layout
- **> 120 cols:** Expand panels horizontally, show more content
- **< 24 rows:** Collapse status bar, reduce panel padding
- **> 40 rows:** Expand trace history, show more disassembly

### 9.3 Dynamic Sizing
- Registers panel: Fixed width (25 chars) or hidden
- Disassembly panel: Flexible width (30-50% of screen)
- Trace panel: Flexible width (30-50% of screen)
- Auxiliary panel: Full width or collapsible
- Status bar: Fixed height (1-2 rows)

## 10. Error Handling

### 10.1 Connection Errors
- Show connection status in status bar
- Retry connection with exponential backoff
- Cache current state for reconnection
- Display warning overlay if disconnected

### 10.2 Protocol Errors
- Log errors to internal buffer
- Show error notification in status bar
- Graceful degradation for unsupported features
- Fallback to polling if events unavailable

### 10.3 UI Errors
- Catch and log rendering exceptions
- Maintain UI responsiveness during errors
- Provide error details in help/debug view
- Allow user to report issues (Ctrl+R)

## 11. Testing Strategy

### 11.1 Unit Tests
- Panel rendering with mock data
- Event routing and filtering
- Keyboard shortcut handling
- Layout calculations for different terminal sizes

### 11.2 Integration Tests
- Full TUI with simulated executive
- Event streaming under load
- Breakpoint workflows
- Multi-panel interactions

### 11.3 Manual Testing
- Cross-platform validation (Windows/macOS/Linux)
- Terminal compatibility (PowerShell, Terminal, tmux)
- Keyboard navigation workflows
- Resize and refresh behavior

### 11.4 Performance Testing
- Event processing latency
- UI update rate under high load
- Memory usage over extended sessions
- Reconnection after network interruption

## 12. Documentation Requirements

### 12.1 User Documentation
- Quick-start guide with screenshots
- Panel descriptions and features
- Keyboard shortcut reference
- Common workflows and examples

### 12.2 Developer Documentation
- Panel implementation guide
- Event handler customization
- Theme and style customization
- Extension points for custom panels

## 13. TUI Mockups

### 13.1 Default Layout (Text Mockup)
```
┌─────────────────────────┬──────────────────────────────────────┬───────────────────────────────┐
│ Registers (PID 2)       │ Execution Trace                     │ Disassembly                   │
│─────────────────────────│──────────────────────────────────────│───────────────────────────────│
│ PC : 0x09F8             │ ▶ 0x09F8: ST  R7 + -4 ← R2           │ 0x09F8: ST   MEM[R7 + -4] <- R2│
│ SP : 0x7FF0             │   0x09FC: ST  R7 + -16 ← R1          │ 0x09FC: ST   MEM[R7 + -16] <- R1│
│ R0 : 0x00000000         │   0x0A00: LD  R9 ← MEM[R7 + -4]      │ 0x0A00: LD   R9, [R7 + -4]      │
│ R1 : 0x000040EF         │   0x0A04: ST  R7 + -20 ← R9          │ 0x0A04: ST   MEM[R7 + -20] <- R9│
│ R2 : 0x00000005         │   0x0A08: JMP 0x0A10                 │ 0x0A08: JMP  0x0A10            │
│ ...                     │   0x0A10: LD  R4 ← MEM[R7 + -20]     │ 0x0A10: LD   R4, [R7 + -20]     │
│                         │                                      │ 0x0A14: CMP  R4, R0             │
│                         │                                      │ ...                            │
├─────────────────────────┴──────────────────────────────────────┴───────────────────────────────┤
│ Tabs: [Mailboxes] [dmesg] [stdio] [scheduler] [breakpoints]                                     │
│────────────────────────────────────────────────────────────────┬────────────────────────────────│
│ ┌ Mailboxes ──────────────────────────────────┐ │ [Alt+S] Step   [Alt+R] Run   [Alt+B] Breakpoints  │
│ │ svc:stdio.in@2   depth=4                │ │ [Alt+C] Continue   [Alt+Q] Quit   [Alt+M] Memory  │
│ │ app:procon       depth=1                │ │ [Alt+W] Watch vars [Alt+T] Trace   [Alt+D] Disasm │
│ │ shared:hsx.msg   depth=3                │ │──────────────────────────────────────────────────│
│ └─────────────────────────────────────────┘ │ Status: RUNNING | PID=2 | Step=1095 | Program:    │
│                                             │ examples/demos/build/mailbox/producer.hxe        │
└────────────────────────────────────────────┴────────────────────────────────────────────────────┘
```

### 13.2 Breakpoint Handling Concepts
- **Virtual breakpoints (default):** Run VM in auto single-step mode and evaluate PC after each instruction; pause when it matches an enabled breakpoint.
- **BRK instruction support:** When BRK opcodes fire (BP_TRAP), debugger enters break mode; coexists with virtual breakpoints.
- **Data model:**
  ```c
  struct Breakpoint {
      uint16_t addr;
      bool     enabled;
      bool     hit;
      char     symbol[32];
  };
  ```

### 13.3 Keyboard Shortcuts Brainstorm
| Function       | Shortcut |
|----------------|----------|
| Step           | Alt+S    |
| Run            | Alt+R    |
| Continue       | Alt+C    |
| Breakpoints    | Alt+B    |
| Watch vars     | Alt+W    |
| Trace toggle   | Alt+T    |
| Disassembly    | Alt+D    |
| Memory view    | Alt+M    |
| Quit           | Alt+Q    |
| Switch tabs    | ← / → or Alt+1–5 |

Tabs can also be toggled programmatically; highlight indicates active pane.

### 13.4 Design Notes
- Tabbed auxiliary panel keeps the layout clean while enabling varied telemetry (mailboxes/dmesg/stdio/scheduler/breakpoints).
- Consistent shortcut legend aids discoverability across pages.
- Automatic single-step execution simplifies breakpoint detection and ensures deterministic behaviour.
- Status bar aggregates mode, PID, runtime counters, and program metadata (pretty output from `ps <pid>`).
- Event flow combines executive-published mailbox notifications with the internal refresh clock so the UI reacts promptly without heavy polling.

## 14. Traceability
- **Design Requirements:** DR-1.3, DR-3.1, DR-8.1.
- **Design Goals:** DG-1.4, DG-8.1, DG-8.2, DG-8.3.
- **Design Options:** DO-relay (future remote debugging), DO-8.a (advanced TUI features).
